---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

# Dithering

<!-- badges: start -->
<!-- badges: end -->

The second prompt for [genuary](https://genuary.art) 2022 is "Dithering". So I had to look it up, and the readings were very helpful see [this](https://surma.dev/things/ditherpunk/)). Dithering seems to involve "quantization" and some random error. Quantization is to map a large number of values to a smaller set of values. 

For this little project I chose an image of the Aztec calendar:
![Calendario Azteca](calendario-azteca.jpg)

I will use the following packages:
```{r load-packages, warning=FALSE, message=FALSE}
library(here)
library(magick)
library(MexBrewer)
library(tidyverse)
```

## Image processing

Read the image using `magick::image_read()`:
```{r}
csa <- image_read(paste0(here(), "/02-dithering/calendario-azteca.jpg"))
```

Check the size of the image: 
```{r}
csa
```
The image is 1,300 pixels in width and 912 in height. To quantize the image I change the size and change the colorspace to gray:
```{r}
set.seed(4533464)
n <- 200

csa <- csa %>% 
  image_resize(paste0(n, "x", collapse = "")) %>%
  image_quantize(max = 15, 
                 colorspace = "gray",
                 treedepth = 3)
```

This is the image after quantizing the colors and changing to grayscale:

```{r}
magick::image_ggplot(csa)
```

New size of the image:
```{r}
csa
```

Save this image; the `image_quantize()` function does not seem to accept a seed and returns different shades of gray on different runs. This image is used from here on:
```r
image_write(csa, path = paste0(here(), "/02-dithering/calendario-azteca-gray.png"), format = "png")
```

Read saved image
```{r}
csa_grey <- image_read(paste0(here(), "/02-dithering/calendario-azteca-gray.png"))
```


Convert image to data frame and check the tones of gray:
```{r}
img_csa <- data.frame(expand.grid(x = seq(1, 200, 1), 
                              y = seq(140, 1, -1)),
                   gray = as.raster(csa_grey) %>% 
                     as.vector()) %>%
  mutate(gray = factor(gray))

levels(img_csa$gray)
  
```

There are ten shades of gray. I will give a number to each of the colors touse this quantity for aesthetic values of the plot:
```{r}
img_csa <- img_csa %>%
  mutate(c = case_when(gray == "#131313ff" ~ 8,
                       gray == "#313131ff" ~ 7,
                       gray == "#505050ff" ~ 6,
                       gray == "#6f6f6fff" ~ 5,
                       gray == "#8f8f8fff" ~ 4,
                       gray == "#afafafff" ~ 3,
                       gray == "#cececeff" ~ 2,
                       gray == "#eaeaeaff" ~ 1
                       ))
```

I will use palettes from the [{MexBrewer}](https://paezha.github.io/MexBrewer/) package.

## Concha

To complete the dithering, I will randomly sample from the data frame before rendering the image. The sampling rate is 50% and the size of the symbols is proportional to the darkness of the original pixel:
```{r dithering-concha, cache=TRUE}
set.seed(80723)
ggplot(data = sample_n(img_csa, 14000), 
       aes(x = x, 
           y = y, 
           color = gray, 
           size = c)) + 
  geom_point(shape = 17,
             alpha = 0.5) +
  scale_color_manual(values = rev(mex.brewer("Concha", 
                                         n = 8))) +
  scale_size(range = c(0.5, 4)) +
  coord_equal() +
  theme_void() + 
  theme(legend.position = "none")
```

## Frida

Use a different palette:
```{r dithering-frida, cache=TRUE}
set.seed(83328)
ggplot(data = sample_n(img_csa, 14000), 
       aes(x = x, 
           y = y, 
           color = gray, 
           size = c)) + 
  geom_point(shape = 17,
             alpha = 0.5) +
  scale_color_manual(values = rev(mex.brewer("Frida", 
                                         n = 8))) +
  scale_size(range = c(0.5, 4)) +
  coord_equal() +
  theme_void() + 
  theme(legend.position = "none")
```

## Aurora

Use a different palette:
```{r dithering-aurora, cache=TRUE}
set.seed(83288)

ggplot(data = sample_n(img_csa, 14000), 
       aes(x = x, 
           y = y, 
           color = gray, 
           size = c)) + 
  geom_point(shape = 17,
             alpha = 0.5) +
  scale_color_manual(values = rev(mex.brewer("Aurora", 
                                         n = 8))) +
  scale_size(range = c(0.5, 4)) +
  coord_equal() +
  theme_void() + 
  theme(legend.position = "none")
```
